#!/usr/bin/env ruby

require 'yaml'
require 'optparse'
require 'hipzap'

config_file = nil
opt_params = {}
opt = OptionParser.new do |opt|
  opt.version = HipZap::VERSION
  opt.on('-f', '--config=FILE', 'specify config file') { |v| config_file = v }
  opt.on('--debug', 'show debug log') { |v| opt_params['debug'] = v }
end

begin
  opt.parse!(ARGV)
rescue OptionParser::ParseError => e
  STDERR.puts "Error: #{e}"
  STDERR.puts opt
  exit 1
end

if config_file
  begin
    params = YAML.load_file(config_file)
  rescue Errno::ENOENT
    STDERR.puts "Error: config file '#{config_file}' not found"
    STDERR.puts opt
    exit 1
  end
else
  begin
    params = YAML.load_file('hipzap.conf')
  rescue Errno::ENOENT
    params = {}
  end
end

config = HipZap::Config.new(params.merge(opt_params))

HipZap::Colorful.new(config).run
